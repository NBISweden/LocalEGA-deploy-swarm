node {
  def remote = [:]
  env.GRADLE_HOME = '/home/ubuntu/.sdkman/candidates/gradle/current'
  remote.name = 'test'
  remote.host = '158.37.63.36'
  remote.user = 'ubuntu'
  remote.password = 'password'
  remote.allowAnyHosts = true
    withCredentials([sshUserPrivateKey(credentialsId: '214dcd62-2e2f-4e9d-8cdd-bbc97c3172c7', keyFileVariable: 'identity', passphraseVariable: '', usernameVariable: 'userName')]) {
        remote.user = userName
        remote.identityFile = identity
      stage('Remote SSH clone') {
        sshCommand remote: remote, command: "rm -rf repo"
        sshCommand remote: remote, command: "mkdir repo"
        sshCommand remote: remote, command: "git clone --single-branch --branch $env.BRANCH_NAME https://github.com/NBISweden/LocalEGA-deploy-swarm.git repo"
        sshCommand remote: remote, command: "$GRADLE_HOME/bin/gradle -p repo bottstrap"
        //writeFile file: 'dep.sh', text: 'gradle -v\r\ngradle clean all\r\nrm -rf repo\r\nmkdir repo\r\ngit clone --single-branch --branch $env.BRANCH_NAME https://github.com/NBISweden/LocalEGA-deploy-swarm.git repo\r\ngradle bootstrap\r\ngradle deployPrivate'
       // sshScript remote: remote, script: "dep.sh"
      } 
  }
}

